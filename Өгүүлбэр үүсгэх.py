# -*- coding: utf-8 -*-
"""Untitled2.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1rF32PoR2IbHF8CnxWwZ1Se5L7knQT-wy
"""

from numpy import array
from keras.preprocessing.text import Tokenizer
from keras.utils import to_categorical
from keras.preprocessing.sequence import pad_sequences
from keras.models import Sequential
from keras.layers import Dense
from keras.layers import LSTM
from keras.layers import Embedding
 
# хэлний моделоос дараалал үүсгэх
def generate_seq(model, tokenizer, max_length, seed_text, n_words):
	in_text = seed_text
	# тодорхой тооны үг үүсгэх
	for _ in range(n_words):
		# үгийг тоо болгон кодлох 
		encoded = tokenizer.texts_to_sequences([in_text])[0]
		
		encoded = pad_sequences([encoded], maxlen=max_length, padding='pre')
		# үг болгоны магадлалыг тооцолох 
		yhat = model.predict_classes(encoded, verbose=0)
		
		out_word = ''
		for word, index in tokenizer.word_index.items():
			if index == yhat:
				out_word = word
				break
		
		in_text += ' ' + out_word
	return in_text

import re
import string 

data = """ Гудиггүй хүнд бол ч шалихгүй жаахан нүгэл юмсанж. Хурууны өндгөнд шигсэн өлөн өргөс төдийхөн юм. Тэгэвч энэ явдлаас хойш Базар цаг мөч тутам шаналж сэтгэлээр уналаа. Алхах гишгэх бүртээ өөрийгөө чагнаж, ямар нэгэн заяагүй явдал нүүрлэнэ дээ гэж ёрлож бодно. Хүссэн юм хүзүүгээр татна гэж. Тэр нь хаврын өглөө хүрээд ирэв. Хонины өрөм шиг улцгар нойтон цасан дээр хальтирч дунд чөмгөө ташсанаар ёрлосон юм ёсоороо болов. Шохойдсон хөлдөө туухай зүүлгэн адар ширтээд “Энэ зэрэгтэй үлдсэн нь их юм. Өрөөл татанхай, эсвэл үхдэг ч үгүй, сэхдэг ч үгүй амьтан хүний гарт орсон бол яана.

Миний нүгэл энүүгээр цайрдаг арга байна уу, үгүй юу” гэж аргаа барна. Өвчтэй хүнд өдөр хоног уртыг хэлэх үү, нүглийн тухай бараан бодол зүрхийг нь чим чим шивэхийг хэлэх үү, хөөрхий Базар энэ хэдхэн хоногт яс арьс болж нүднээс гарлаа. Өглөөд хоол цай хайнгадуу хандуулж хаяад, янзгүй хөхөлзөн гарч одох эхнэрээ хараад нэмж уйтгарлана. Савагдаж ёолох хаалганы салхи Базарын хавирга сүвэргийг нэвт жиндүүлж, зүрхийг хайрна. Ийм байхад Базарын хоолойгоор юу ч давахгүй горойж “Би ч нүглийн тариа юм даа. Ямар золигоо хийв ээ. Юу олов. Юу хожив. Тарга тэвээрэг авсан бол яамай гэх сэн. Хүсэл ханаж цадсан бол бас яахав гэхсэн. Өнгөрчээ, арай чамай босгосон амьдралаа үрэн таран болгов. Эхнэр, энэ зэрэгтэй аяга цай дөхүүлж байгаа нь их юм” гэж зүдэргээт бодолдоо өөрийгөө хэмлэнэ.

Базар бол ганц ээлжийн хүрмээ арван жил сэлгээгүй нямбай өмсөж, хэтэвчин дэх бутархай мөнгөө ч тооцож зарцуулдаг, нэг л замаараа арван жил ажилдаа алхсан, швейцарь цаг шиг найдвартай эр юм. Гэвч хорьж болдоггүй үйл, цааргалж дийлэхгүй хүсэл гэж байдаг. Базар шиг хүн ч байсан барьц алдан үйж үхмээр сайхан нүдтэй бүсгүй хүн орчлонд олон. Тийм л нэг лай ланчигт уначихаад сөртөн нь сөнөж, сахил санваараа алдсан хувраг бурхан багшийн өмнө гэтэлж давшгүй нүгэл хийхийн дайтай шаналжээ. Алдаа оноо нь алганы хээ шиг илхэн байдаг ноомой ядруу нөхөр нь хувирч өөрчлөгдөн, юм л бол дуу аялан гэгэлзэхийг анзаарахгүй өнгөрөх эхнэр гэж байх уу. Орондоо орсон хойноо эр нөхрийнхөө цээжийг илж таалж байснаа эхнэр нь,

-Цаадах чинь тэгээд хэдтэй юм бэ дээ? гэж цохилдуулав. Базар ийм цочир түргэн юманд бултаа зайлаа муутай, эв дүйгүй хүн.

-Нялх юм даа. Хүүхдээрээ шахуу амьтан юм гэсэн үг унагачаад, өнөөх гайтай үгээ араас нь элдэж, барьж авах гэж ороолдсон утасны үзүүр хайх шиг хачин юм болгоод хаячив.

-Арай дээгүүр сэвсэн юм биш үү. Залуу охины хөлд үрэгдэв дээ Базар минь гэж зүрхийг нь ёгхийтэл хэлчээд эхнэр нь буруу харан хэвтжээ.

Базарын нойр алсын алсад хулжин одов. Өнгөрсөн амьдрал, алдаж оносон эсэхээ ширхэгчлэн бүртгэв. Ингэтлээ догдолж, хөөрч, гуниглаж, савнаас хальсан горхи шиг үерлэж явсан нь хэзээ, хаана билээ. Хонуутаар алга болж, найз нөхөдтэйгээ савж, шартсан, царай зүс гэж авах юмгүй амьтан гэртээ ирж байсан уу. Цалингаа тоо ёсоор нь эхнэртээ аваачиж тушаачихаад, маргааш нь тамхины мөнгө цувуулж авдаг над шиг хүн яаж тийм их зориг гаргаж, өөрийгөө гололгүй сэвж, өөрөөсөө дээгүүр бүсгүйд сэтгэл алдарч чадав аа. Бодох тусам бах нь ханах авч энэ бардам бодлыг нь уншчих вий гэсэн шиг өнгийж харав. Эхнэр нь жигд зөөлөн хурхирч байлаа. Уул нь санаа алдаж, нулимсаа цувуулж байгаа бол уу гэж зүрх нь шимширч байжээ. Тэгтэл Базарын хэлснийг нохой хуцсан дайтай бодолгүй унтаад өгч. Эр нөхөр нь залуу охинд сэтгэлийн жолоо цулбуураа алдаж, тэрнийгээ эрээ цээргүй хэлж байхад хүн гэж тоохгүй унтаж л байдаг.

…Багадаа хамт тоглодог Мөндөл гэдэг охин байж билээ. Нэр нь Мөндөл юм уу, өхөөрдөөд Мөндөл гэдэг байсан юм уу, том багагүй л Мөндөл, Мөндөл гэдэг байлаа. Зээрийн янзага шиг зэрэмгэр, адтай, цолгиун охин. Тэр хоёр чулуун гэр барьж хээр гадаа эрхэлдэг байж билээ. Яагаад Мөндөлийг дурсав гэдгээ Базар ойлгосонгүй. Хүүхэдтэй л адил хүүхэд, адтай сэргэлэн л хүүхэд байж билээ. Базар архи уусан том эр хүн болж саваа зайдлан шороо бужигнуулж, гуйван дайван орилж хашгирч тонгочдог байлаа. Хүүхэд байтлаа Мөндөл бүр хэзээний айлын авгай шиг “Унт аа хө. Маргааш архи уувал тархийг чинь хага цохино шүү” гэдэгсэн. Базар энэ үгийг л тод санав. Мөндөлийн хувьд болохгүй юм гэж орчлонд байхгүй, бүх юм болно. Архи ууж болно, агсам тавьж болно, тэр байтугай зодоон цохион хийж болно. Хулгай хийж болно, хамгийн гол нь баригдахгүй байх хэрэгтэй гэж хэлдэгсэн. Одоо санахад Мөндөл хачин хүүхэд байжээ.

Базар эмнэлэгт сар шахам болов. Өөртэйгээ зөрчилдөж, ширээний цагийн урт зүү тоолж хэвтэх гэдэг нажид зовлонтой л юм. Хачирхалтай нь Мөндөл ойрхон ойрхон санаанд нь орж ирнэ. Ямартай ч Мөндөлийг дурсаад хачин их тайвширч, эртхэн ингэж сэтгэж, эртхэн ингэж хүн шиг алдаж тэрүүндээ гэмшиж, баярлаж хүн шиг явах минь яав даа гэж харуусав. Ингэж бодохтой зэрэг хар багын найз нөхөдтэйгээ ууж сууж дарвиж, согтуурч мансуурахсан гэсэн этгээд халуун хүсэл төрөв. Базарын сэтгэлд өмнө нь ийм халуун хүсэл төрж байсан билүү, үгүй билүү. “Мөндөлийг дурссан нь сайн болов, цаашид илжиг шиг амьдрахаа больё. Хоёрхон төө, гуравхан сөөм амьдралд унаж босч, жаргаж зовж амьдрах минь. Гүйцээ, хуучин амьдралаа навтарга цаас шиг шатаах минь” гэж эрслэн бодтол гэв гэнэтхэн зүрхний чим чим гэх зовиур, хавирга сүвэргэ нэвт жиндүүлэх жавар аль аль нь алга болж, тэр шаналалын оронд хугархай муу хөл нь янгинаж байв. Базар эмнэлэгт хэвтсээр анх удаа инээмсэглэв. Тэгээд нэг сонин нээлт бодож олов. Мах яс өвдөх гэдэг чинь хүүхдийн тоглоом юм. Хөл хугарах чинь урам хугарахаас хамаагүй дээр юм байна гэж. Бодох тусам дотроос халуун оргиж, инээмсэглэмээр байлаа. Гэвч тэр ганцаараа инээсэнгүй. Хаалга зөөлөн нээгээд орж ирсэн эхнэр нь бас инээмсэглэн зогсож байжээ. “Эхнэр инээмсэглэнэ гэдэг сайны ёр уу, муугийн ёр уу” гэж Базар сэртэсхийсэн ч “За дүүрсэн хорвоо. Сална гэвэл сална даа цус” гэж бардам боджээ. Эхнэр нь цай аягалж бариад,

-Хоол цайгаа халуун идэж уу даа гэв. Дуу нь цөхөрч, итгэл алдсан өнгө тод. Базарын хоолой аргаж хатаад хэлэх үг олдсонгүй.

-Тэр охиныг чинь харлаа. Нүд дүүрэн сайхан охин байна. Над шиг битгий болгочоорой. Ахиж хэлэхгүй биз дээ Базар минь. Эр хүн шиг уулын орой харж яваарай. Чи гутлынхаа хоншоороос цаадахийг олж үздэггүй охорхон бодолтой шүү. Тийм болохоор чинь л зааж зааварлаж, үглэж яншиж чамайг гутаасан байх. Алдсан ч, оносон ч эр хүн шиг байсан бол би чиний гарын аясыг дагах л байсан. Уул нь би эр нөхрийнхөө толгойд асах тийм цадигаа алдсан хүн байгаагүй юм шүү гээд хоолой нь зангирав. Базарын царай хүрлийж, шартсан хүн шиг дотор муухайрч хачин оргив.

Эхнэр нь Мөндөлтэй ямар адилхан юм бэ. Мөндөлөөс л ийм үг өлхөн гарна. Мөндөл ийм гэм нүглийг ингэж цайруулж бодож чадна. Ингэж бодмогц Базарт эвгүй муухай совин татаад явчихав. “Сална гэвэл сална даа цус” гэсэн давилуун бодол нь салхинд хийсч, энүүнгүйгээр би яаж амьд явж чадах юм бэ. Энэ сайхан нарны дор хүн хайрлах нь нүгэл болдог юм бол нүгэлгүй хүн гэж энэ орчлонд байх уу. Базарын хийсэн тэр нүглийг нь уучилж чадах ийм халуун сэтгэлийг ээдүүлж гашилгавал тэр хамгийн том нүгэл юм биш үү гэсэн хачин уяхан бодол сэрхийтэл ороод иржээ. """
def clean_text(text):

    text = text.lower()
    text = re.sub(r'\[*?\]', '', text)
    if len(text) > 2:
        return ' '.join(word for word in text.split())
# Функцаа дуудаж ажлуулна
data= clean_text(data)
print(data)

tokenizer = Tokenizer()
tokenizer.fit_on_texts([data])
# үгийн сангийн хэмжээг тодорхойлох
vocab_size = len(tokenizer.word_index) + 1
print('Vocabulary Size: %d' % vocab_size)
# шугманд сурилсан дараалал үүсгэх
sequences = list()
for line in data.split('.'):
	encoded = tokenizer.texts_to_sequences([line])[0]
	for i in range(1, len(encoded)):
		sequence = encoded[:i+1]
		sequences.append(sequence)
print('Total Sequences: %d' % len(sequences))

max_length = max([len(seq) for seq in sequences])
sequences = pad_sequences(sequences, maxlen=max_length, padding='pre')
print('Max Sequence Length: %d' % max_length)
# гаралт оролтын элемент болгон хуүваах 
sequences = array(sequences)
X, y = sequences[:,:-1],sequences[:,-1]
y = to_categorical(y, num_classes=vocab_size)
# моделтг тодорхойлох
model = Sequential()
model.add(Embedding(vocab_size, 10, input_length=max_length-1))
model.add(LSTM(50))
model.add(Dense(vocab_size, activation='softmax'))
print(model.summary())

model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
history = model.fit(X, y, epochs=100, verbose=1)



model.compile(loss='categorical_crossentropy', optimizer='adam', metrics=['accuracy'])
history = model.fit(X, y, epochs=100, verbose=1)

import matplotlib.pyplot as plt

def plot_graphs(history, string):
  plt.plot(history.history[string])
  plt.xlabel("Epochs")
  plt.ylabel(string)

  plt.show()
plot_graphs(history, "accuracy")
plot_graphs(history, "loss")



print(generate_seq(model, tokenizer, max_length-1, 'Гадны', 20))
print(generate_seq(model, tokenizer, max_length-1, 'дүү', 20))



















